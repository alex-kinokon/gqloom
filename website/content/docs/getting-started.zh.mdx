---
title: 快速上手
icon: PencilRuler
---

为了快速上手 GQLoom，我们将一起搭建一个简单的 GraphQL 后端应用。

我们将搭建一个猫舍应用，并为向外部提供 GraphQL API。
该应用将包含一些简单的功能：
- 猫基础信息管理：录入猫的的基本信息，包括名称、性别、生日等，更新、删除和查询猫；
- 用户（猫主人）登记管理：录入用户信息，简单的登录功能，查看用户的猫；

我们将使用以下技术：
- [TypeScript](https://www.typescriptlang.org/): 作为我们的开发语言；
- [Node.js](https://nodejs.org/): 作为我们应用的运行时；
- [graphql.js](https://github.com/graphql/graphql-js): GraphQL 的 JavaScript 实现；
- [GraphQL Yoga](https://the-guild.dev/graphql/yoga-server): 功能全面的 GraphQL HTTP 适配器；
- [Drizzle ORM](https://orm.drizzle.team/): 一个快速且类型安全的 ORM，帮助我们操作数据库；
- [Valibot](https://valibot.dev/) 或者 [Zod](https://zod.dev/): 用于定义和验证输入；
- `GQLoom`: 让我们舒适且高效地定义 GraphQL Schema 并编写解析器（Resolver）；

## 前提条件

我们只需要安装版本 20 以上的 [Node.js](https://nodejs.org/) 来运行我们的应用。

## 创建应用

### 初始化项目并安装依赖

首先，让我们新建文件夹并初始化项目：

<Tabs groupId="package-manager" items={["npm", "pnpm" , "yarn"]}>
<Tab>
```sh
mkdir cattery
cd ./cattery
npm init -y
```
</Tab>
<Tab>
```sh
mkdir cattery
cd ./cattery
pnpm init
```
</Tab>
<Tab>
```sh
mkdir cattery
cd ./cattery
yarn init -y
```
</Tab>
</Tabs>

然后，我们将安装一些必要的依赖来以便在 Node.js 运行中 TypeScript 应用：

<Tabs groupId="package-manager" items={["npm", "pnpm" , "yarn"]}>
<Tab>
```sh
npm i -D typescript @types/node tsx
npx tsc --init
```
</Tab>
<Tab>
```sh
pnpm add -D typescript @types/node tsx
pnpm exec tsc --init
```
</Tab>
<Tab>
```sh
yarn add -D typescript @types/node tsx
yarn dlx -q -p typescript tsc --init
```
</Tab>
</Tabs>

接下来，我们将安装 GQLoom 以及相关依赖，我们可以选择 [Valibot](https://valibot.dev/) 或者 [Zod](https://zod.dev/) 来定义并验证输入：

<Tabs groupId='schema-builder' items={["valibot", "zod"]}>
<Tab>
<Tabs groupId="package-manager" items={["npm", "pnpm" , "yarn"]}>
<Tab>
```sh
npm i graphql graphql-yoga @gqloom/core valibot @gqloom/valibot
```
</Tab>
<Tab>
```sh
pnpm add graphql graphql-yoga @gqloom/core valibot @gqloom/valibot
```
</Tab>
<Tab>
```sh
yarn add graphql graphql-yoga @gqloom/core valibot @gqloom/valibot
```
</Tab>
</Tabs>
</Tab>
<Tab>
<Tabs groupId="package-manager" items={["npm", "pnpm" , "yarn"]}>
<Tab>
```sh
npm i graphql graphql-yoga @gqloom/core zod @gqloom/zod
```
</Tab>
<Tab>
```sh
pnpm add graphql graphql-yoga @gqloom/core zod @gqloom/zod
```
</Tab>
<Tab>
```sh
yarn add graphql graphql-yoga @gqloom/core zod @gqloom/zod
```
</Tab>
</Tabs>
</Tab>
</Tabs>

### 你好，世界

让我们编写第一个[解析器](./resolver):

```ts twoslash title="src/resolvers/index.ts"
import { query, resolver } from "@gqloom/core"
import { z } from "zod"

const helloResolver = resolver({
  hello: query(z.string())
    .input({
      name: z
        .string()
        .nullish()
        .transform((x) => x ?? "World"),
    })
    .resolve(({ name }) => `Hello ${name}!`),
})

export const resolvers = [helloResolver]
```

我们需要将这个解析器编织成 GraphQL Schema，并以 HTTP 服务器的形式运行它：

```ts twoslash
// @filename: resolvers.ts
import { query, resolver } from "@gqloom/core"
import { z } from "zod"

const helloResolver = resolver({
  hello: query(z.string())
    .input({
      name: z
        .string()
        .nullish()
        .transform((x) => x ?? "World"),
    })
    .resolve(({ name }) => `Hello ${name}!`),
})

export const resolvers = [helloResolver]
// @filename: index.ts
// ---cut---
import { createServer } from "node:http"
import { weave } from "@gqloom/core"
import { ZodWeaver } from "@gqloom/zod"
import { createYoga } from "graphql-yoga"
import { resolvers } from "./resolvers"

const schema = weave(ZodWeaver, ...resolvers)

const yoga = createYoga({ schema })
createServer(yoga).listen(4000, () => {
  console.info("Server is running on http://localhost:4000/graphql")
})
```

很好，我们已经创建了一个简单的 GraphQL 应用。  
接下来我们尝试运行这个应用，在 `package.json` 里添加 `dev` 脚本：
```json
"scripts": {
  "dev": "tsx watch src/index.ts"
}
```

现在让我们运行一下：

<Tabs groupId="package-manager" items={["npm", "pnpm" , "yarn"]}>
<Tab>
```sh
npm run dev
```
</Tab>
<Tab>
```sh
pnpm dev
```
</Tab>
<Tab>
```sh
yarn dev
```
</Tab>
</Tabs>

在浏览器中打开 http://localhost:4000/graphql 就可以看到 GraphQL 演练场了。  
让我们尝试发送一个 GraphQL 查询，在演练场里输入:

```gql title="GraphQL Query" 
{
  hello(name: "GQLoom")
}
```

点击查询按钮，就可以看到结果了：

```json
{
  "data": {
    "hello": "Hello GQLoom!"
  }
}
```

## 初始化数据库